{"version":3,"sources":["webpack://@raafirivero/mason/webpack/bootstrap","webpack://@raafirivero/mason/./forum.js","webpack://@raafirivero/mason/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@raafirivero/mason/./src/forum/addComposerFields.js","webpack://@raafirivero/mason/./src/forum/addFieldUpdateControl.js","webpack://@raafirivero/mason/./src/forum/addFieldsOnDiscussionHero.js","webpack://@raafirivero/mason/./src/forum/addFieldsOnDiscussionPost.js","webpack://@raafirivero/mason/./src/forum/components/ByTagsComposer.js","webpack://@raafirivero/mason/./src/forum/components/FieldEditDropdown.js","webpack://@raafirivero/mason/./src/forum/components/FieldEditTags.js","webpack://@raafirivero/mason/./src/forum/components/FieldEditText.js","webpack://@raafirivero/mason/./src/forum/components/FieldGrid.js","webpack://@raafirivero/mason/./src/forum/components/FieldsEditor.js","webpack://@raafirivero/mason/./src/forum/components/FieldsEditorByTags.js","webpack://@raafirivero/mason/./src/forum/components/FieldsEditorModal.js","webpack://@raafirivero/mason/./src/forum/components/FieldsViewer.js","webpack://@raafirivero/mason/./src/forum/helpers/chunkArray.js","webpack://@raafirivero/mason/./src/forum/index.js","webpack://@raafirivero/mason/./src/forum/patchModelIdentifier.js","webpack://@raafirivero/mason/./src/lib/helpers/sortByAttribute.js","webpack://@raafirivero/mason/./src/lib/models/Answer.js","webpack://@raafirivero/mason/./src/lib/models/ByTag.js","webpack://@raafirivero/mason/./src/lib/models/Field.js","webpack://@raafirivero/mason/external \"flarum.core.compat['Component']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['Model']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['app']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['components/Button']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['components/CommentPost']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['components/Composer']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['components/DiscussionComposer']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['components/DiscussionHero']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['components/Modal']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['extend']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['helpers/icon']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['models/Discussion']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['models/Forum']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['tags/components/TagDiscussionModal']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['tags/utils/sortTags']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['utils/DiscussionControls']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['utils/ItemList']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['utils/computed']\"","webpack://@raafirivero/mason/external \"flarum.core.compat['utils/mixin']\""],"names":["DiscussionComposer","prototype","raafiriveroMasonAnswers","byTagEnabled","app","data","resources","attributes","ByTagsUnit","ByTagsComposer","dTag","extend","TagDiscussionModal","e","selected","name","Composer","items","forum","canFillRaafiRiveroMasonFields","matchingTags","matchTags","myFields","i","length","tagName","fields","add","FieldsEditorByTags","component","bytags","answers","onchange","FieldsEditor","ontagchange","tags","relationships","override","loading","console","log","store","createRecord","save","then","discussion","composer","hide","cache","discussionList","refresh","m","route","loaded","bind","DiscussionControls","canUpdateRaafiRiveroMasonAnswers","Button","children","translator","trans","icon","onclick","modal","show","FieldsEditorModal","DiscussionHero","props","canSeeRaafiRiveroMasonAnswers","attribute","FieldsViewer","original","position","$composer","$","stop","composerHeight","outerHeight","redraw","headerHeight","PositionEnum","NORMAL","height","updateHeight","showFieldsOnPost","post","number","CommentPost","subtree","check","map","answer","id","join","content","postHeaderIndex","findIndex","item","attrs","className","splice","init","all","tagsList","tempStorage","usedList","fieldIDs","tagsObj","filter","match","tag_name","forEach","push","JSON","parse","allowed_field","Component","FieldEditDropdown","field","view","selectedAnswerIdsForThisField","suggested_answers","answerIndex","a","multiple","event","target","options","option","value","answerId","getById","disabled","required","hidden","placeholderHidden","selectPlaceholder","sortByAttribute","indexOf","text","DiscussionFields","selectedTags","tag","canAddToDiscussion","canStartDiscussion","minPrimary","maxPrimary","minSecondary","maxSecondary","isPrimary","sortTags","currentSelectedChild","sort","parent","fieldRequired","fieldLabel","withAttr","find","FieldEditText","answersForThisField","oninput","Model","getIdentifier","placeholder","fieldPlaceholder","FieldGrid","chunkArray","row","answerToFieldIndex","onsubmit","preventDefault","headItems","toArray","fieldItems","updateSelection","fieldAnswers","reverseFieldLookup","concat","ItemList","FieldEditTags","inputAttrs","input","user_values_allowed","description","dirty","processing","title","answersChanged","saveAnswers","close","err","Modal","head","fieldsItems","answer_list","show_when_empty","itemsPerChunk","R","slice","initializers","models","Field","Answer","ByTag","Discussion","hasMany","Forum","addComposerFields","addFieldsOnDiscussionHero","addFieldsOnDiscussionPost","addFieldUpdateControl","patchModelIdentifier","model","exists","type","attr","b","apiEndpoint","mixin","is_suggested","hasOne","tag_id","min_answers_count","max_answers_count","validation","deleted_at","transformDate","all_answers","computed"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export * from './src/forum';\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import {extend, override} from 'flarum/extend';\nimport app from 'flarum/app';\nimport DiscussionComposer from 'flarum/components/DiscussionComposer';\nimport Composer from 'flarum/components/Composer';\nimport FieldsEditor from './components/FieldsEditor';\nimport FieldsEditorByTags from './components/FieldsEditorByTags';\nimport ByTagsComposer from './components/ByTagsComposer';\nimport TagDiscussionModal from 'flarum/tags/components/TagDiscussionModal';\n\n\nexport default function () {\n    DiscussionComposer.prototype.raafiriveroMasonAnswers = [];\n    let byTagEnabled = app.data.resources[0].attributes['raafirivero.mason.by-tag'];\n    let ByTagsUnit = new ByTagsComposer;\n    let dTag = '';\n    \n\n    extend(TagDiscussionModal.prototype, 'onsubmit', function(e) {\n        // get name of the tag selected in the modal\n\n        if (this.selected == false) {\n            // send a command to empty the field here\n            dTag = '';\n            // DC.init();\n            return;\n        }\n\n        dTag = this.selected[0].data.attributes.name;\n    })\n\n    extend(Composer.prototype, 'hide', function(e) {\n        // remove the the fields from the headerItems...\n        \n    })\n\n\n    extend(DiscussionComposer.prototype, 'headerItems', function (items) {\n        if (!app.forum.canFillRaafiRiveroMasonFields()) {\n            return;\n        }\n\n        // so this list contains whether a tag has fields!\n        const matchingTags = ByTagsUnit.matchTags();\n\n        if(byTagEnabled) {\n            // fields selectively show up on byTag posts\n            let myFields = [];\n\n            for (let i = 0; i < matchingTags.length; i++) {\n                if (matchingTags[i].tagName == dTag) {\n                    myFields = matchingTags[i].fields;\n                } \n            }      \n            // myFields is a list of only fields that match the selected tag\n\n            items.add('raafirivero-mason-fields', FieldsEditorByTags.component({\n                    bytags: myFields,\n                    answers: this.raafiriveroMasonAnswers,\n                    onchange: answers => {\n                        this.raafiriveroMasonAnswers = answers;\n                    },\n            }));\n\n        } else {\n            // console.log(\"the old way\");\n            // show the fields on every post. (the original setup for the plugin)\n\n            items.add('raafirivero-mason-fields', FieldsEditor.component({\n                answers: this.raafiriveroMasonAnswers,\n                onchange: answers => {\n                    this.raafiriveroMasonAnswers = answers;\n                },\n                ontagchange: tags => {\n                    this.tags = tags;\n                },\n            }));\n\n        }\n    });\n\n    extend(DiscussionComposer.prototype, 'data', function (data) {\n        if (!app.forum.canFillRaafiRiveroMasonFields()) {\n            return;\n        }\n\n        // this sends only filled fields to the server\n        data.relationships = data.relationships || {};\n        data.relationships.raafiriveroMasonAnswers = this.raafiriveroMasonAnswers;\n\n    });\n\n    override(DiscussionComposer.prototype, 'onsubmit', function () {\n        this.loading = true;\n\n        const data = this.data();\n\n        console.log(data);\n    \n        app.store\n          .createRecord('discussions')\n          .save(data)\n          .then((discussion) => {\n            app.composer.hide();\n            app.cache.discussionList.refresh();\n            m.route(app.route.discussion(discussion));\n          }, this.loaded.bind(this));\n    });\n}\n","import {extend} from 'flarum/extend';\nimport DiscussionControls from 'flarum/utils/DiscussionControls';\nimport Button from 'flarum/components/Button';\nimport FieldsEditorModal from './components/FieldsEditorModal';\n\nexport default function () {\n    extend(DiscussionControls, 'moderationControls', function (items, discussion) {\n        if (discussion.canUpdateRaafiRiveroMasonAnswers()) {\n            items.add('raafirivero-mason-update-answers', Button.component({\n                children: app.translator.trans('raafirivero-mason.forum.discussion-controls.edit-answers'),\n                icon: 'fas fa-tag',\n                onclick: () => app.modal.show(new FieldsEditorModal({discussion})),\n            }));\n        }\n    });\n}\n","import {extend, override} from 'flarum/extend';\nimport app from 'flarum/app';\nimport DiscussionHero from 'flarum/components/DiscussionHero';\nimport Composer from 'flarum/components/Composer';\nimport FieldsViewer from './components/FieldsViewer';\n\nexport default function () {\n    extend(DiscussionHero.prototype, 'items', function (items) {\n        if (!this.props.discussion.canSeeRaafiRiveroMasonAnswers() || !app.forum.attribute('raafirivero.mason.fields-in-hero')) {\n            return;\n        }\n\n        items.add('raafirivero-mason-fields', FieldsViewer.component({\n            discussion: this.props.discussion,\n        }));\n    });\n\n    override(Composer.prototype, 'animateToPosition', function (original, position) {\n        // we need to detect if there are any mason fields present and if there are\n        // add their height to the default height of the composer window\n\n        // we have to show the composer in order to get the current height from it,\n        // otherwise the fields are not drawn yet\n        const $composer = this.$().stop(true);\n        const composerHeight = $composer.outerHeight();\n        m.redraw(true);\n        $composer.show();\n\n        const headerHeight = this.$('.ComposerBody-header').outerHeight();\n\n        if (position === Composer.PositionEnum.NORMAL && composerHeight < headerHeight) {\n            this.height = headerHeight + composerHeight;\n            this.updateHeight();\n        }\n\n        return original(position);\n    });\n\n    // extend(Composer.prototype, 'maximumHeight', function () {\n    //     //console.log('4');\n    //     return 800;\n    // });\n}","import {extend} from 'flarum/extend';\nimport app from 'flarum/app';\nimport CommentPost from 'flarum/components/CommentPost';\nimport FieldsViewer from './components/FieldsViewer';\n\nfunction showFieldsOnPost(post) {\n    // We only add fields to the first post, and only if fields are not displayed in the hero\n    // TODO: what if the first post is deleted ?\n    return post.number() === 1 && !app.forum.attribute('raafirivero.mason.fields-in-hero');\n}\n\nexport default function () {\n    extend(CommentPost.prototype, 'init', function () {\n        if (!this.props.post.discussion().canSeeRaafiRiveroMasonAnswers() || !showFieldsOnPost(this.props.post)) {\n            return;\n        }\n\n        this.subtree.check(() => {\n            // Create a string with all answer ids\n            // If answers change this string will be different\n            return this.props.post.discussion().raafiriveroMasonAnswers().map(answer => answer.id()).join(',');\n        });\n    });\n\n    extend(CommentPost.prototype, 'content', function (content) {\n        if (!this.props.post.discussion().canSeeRaafiRiveroMasonAnswers() || !showFieldsOnPost(this.props.post)) {\n            return;\n        }\n\n        const postHeaderIndex = content.findIndex(item => item.attrs && item.attrs.className === 'Post-header');\n\n        // Insert the new content just after the header\n        // or at the very beginning if the header is not found\n        content.splice(postHeaderIndex === -1 ? 0 : postHeaderIndex + 1, 0, FieldsViewer.component({\n            discussion: this.props.post.discussion(),\n        }));\n    });\n}\n","import app from 'flarum/app';\nimport Component from 'flarum/Component';\n\nexport default class ByTagsComposer extends Component {\n\n    init() {\n        // app.store;\n        // guess I didn't need this part\n    }\n\n    matchTags() {\n        // build an array of Tags with the fields that match them\n\n        const tags = app.store.all('tags');\n        let tagsList = [];\n        \n        \n        let tempStorage = app.store.all('raafirivero-mason-bytag');\n        var usedList = [];\n\n        for ( let i = 0; i < tags.length; i++){   \n            let fields = [];\n            let fieldIDs = [];\n            var tagName = tags[i].data.attributes.name;\n            let tagsObj = {};\n\n            usedList = tempStorage.filter(match => match.data.attributes.tag_name == tagName && match.data.attributes.switch == true);\n\n            // It may be better to create an object with all the Tags represented\n            // even if they have no fields enabled. Turn this conditional back off if so.\n            if (usedList[0]) {\n\n                usedList.forEach(function(e){\n                    fields.push(JSON.parse(e.data.attributes.allowed_field));\n                    fieldIDs.push(e.data.id);\n                });\n\n                tagsObj = {tagName,fields,fieldIDs};\n                tagsList.push(tagsObj);\n            }\n        }\n\n        return tagsList;        \n    }\n\n}","import app from 'flarum/app';\nimport icon from 'flarum/helpers/icon';\nimport Component from 'flarum/Component';\nimport sortByAttribute from './../../lib/helpers/sortByAttribute';\n\nexport default class FieldEditDropdown extends Component {\n    init() {\n        this.field = this.props.field;\n        this.answers = this.props.answers;\n        this.onchange = this.props.onchange;\n    }\n\n    view() {\n        let selectedAnswerIdsForThisField = [];\n\n        this.field.suggested_answers().forEach(answer => {\n            const answerIndex = this.answers.findIndex(a => {\n                // Temporary store entries seem to turn into undefined after saving\n                if (typeof a === 'undefined') {\n                    return false;\n                }\n\n                return a.id() === answer.id();\n            });\n\n            if (answerIndex !== -1) {\n                selectedAnswerIdsForThisField.push(answer.id());\n            }\n        });\n\n        return m('span.Select', [\n            m('select.Select-input.FormControl', {\n                multiple: this.field.multiple(),\n                onchange: event => {\n                    let answers = [];\n\n                    for (let option of event.target.options) {\n                        if (option.selected && option.value !== 'none') {\n                            const answerId = option.value;\n\n                            // This will only work with suggested answers for now\n                            // As they are the only ones registered in the store\n                            answers.push(app.store.getById('raafirivero-mason-answer', answerId));\n                        }\n                    }\n\n                    this.onchange(answers);\n                },\n            }, [\n                (this.field.multiple() ? null : m('option', {\n                    value: 'none',\n                    selected: selectedAnswerIdsForThisField.length === 0,\n                    disabled: this.field.required(),\n                    hidden: this.placeholderHidden(),\n                }, this.selectPlaceholder())),\n                sortByAttribute(this.field.suggested_answers()).map(\n                    answer => m('option', {\n                        value: answer.id(),\n                        selected: selectedAnswerIdsForThisField.indexOf(answer.id()) !== -1,\n                    }, answer.content())\n                ),\n            ]),\n            icon('fas fa-caret-down', {className: 'Select-caret'}),\n        ]);\n    }\n\n    placeholderHidden() {\n        // If labels are hidden, we need to always show the default value (even if it can't be selected)\n        // Otherwise when the field is \"required\" you can't find the name of the field anymore once something is selected\n        if (app.forum.attribute('raafirivero.mason.labels-as-placeholders')) {\n            return false;\n        }\n\n        return this.field.required();\n    }\n\n    selectPlaceholder() {\n        let text = '';\n\n        if (app.forum.attribute('raafirivero.mason.labels-as-placeholders')) {\n            text += this.field.name();\n\n            if (this.field.required()) {\n                text+= ' *';\n            }\n\n            text += ' - ';\n        }\n\n        if (this.field.required()) {\n            text += app.translator.trans('raafirivero-mason.forum.answers.choose-option');\n        } else {\n            text += app.translator.trans('raafirivero-mason.forum.answers.no-option-selected');\n        }\n\n        return text;\n    }\n}\n","import app from 'flarum/app';\nimport icon from 'flarum/helpers/icon';\nimport Component from 'flarum/Component';\nimport sortTags from 'flarum/tags/utils/sortTags';\n\nexport default class DiscussionFields extends Component {\n    init() {\n        this.tags = app.store.all('tags');\n        this.selectedTags = [];\n\n        if (this.props.discussion) {\n            this.tags = this.tags.filter(tag => tag.canAddToDiscussion() || this.props.discussion.tags().indexOf(tag) !== -1);\n\n            this.selectedTags = this.props.discussion.tags();\n        } else {\n            this.tags = this.tags.filter(tag => tag.canStartDiscussion());\n        }\n\n        this.minPrimary = app.forum.attribute('minPrimaryTags');\n        this.maxPrimary = app.forum.attribute('maxPrimaryTags');\n        this.minSecondary = app.forum.attribute('minSecondaryTags');\n        this.maxSecondary = app.forum.attribute('maxSecondaryTags');\n\n        // If primary tags are disabled, don't offer them\n        if (this.maxPrimary <= 0) {\n            this.tags = this.tags.filter(tag => !tag.isPrimary());\n        }\n\n        // If secondary tags are disabled, don't offer them\n        if (this.maxSecondary <= 0) {\n            this.tags = this.tags.filter(tag => tag.isPrimary());\n        }\n\n        this.tags = sortTags(this.tags);\n    }\n\n    view() {\n        if (this.maxPrimary > 1 || this.maxSecondary > 1) {\n            return m('.Alert', app.translator.trans('raafirivero-mason.forum.tags.inadequate-settings'));\n        }\n\n        // We take the first child selected or if none, the first parent selected\n        // Of course this only works if a single tag or tag+parent is selected\n        // Multiple tags are not supported on this selector\n        const currentSelectedChild = this.selectedTags.length ? this.selectedTags.sort(tag => tag.parent() ? -1 : 1)[0].id() : null;\n\n        const required = this.fieldRequired();\n\n        return m('.Mason-Field.Form-group', {\n            className: app.forum.attribute('raafirivero.mason.labels-as-placeholders') ? 'Mason-Field--label-as-placeholder' : '',\n        }, [\n            m('label', this.fieldLabel()),\n            m('span.Select', [\n                m('select.Select-input.FormControl', {\n                    onchange: m.withAttr('value', id => {\n                        this.selectedTags = [];\n\n                        if (id !== 'none') {\n                            this.selectedTags.push(this.tags.find(tag => tag.id() === id));\n\n                            const parent = this.selectedTags[0].parent();\n                            if (parent) {\n                                this.selectedTags.push(parent);\n                            }\n                        }\n\n                        this.props.onchange(this.selectedTags);\n                    }),\n                }, [\n                    m('option', {\n                        value: 'none',\n                        selected: this.selectedTags.length === 0,\n                        disabled: required,\n                        hidden: this.placeholderHidden(),\n                    }, this.selectPlaceholder()),\n                    this.tags.map(\n                        tag => {\n                            const parent = tag.parent();\n\n                            return m('option', {\n                                value: tag.id(),\n                                selected: tag.id() === currentSelectedChild,\n                            }, (parent ? parent.name() + ' | ' : '') + tag.name());\n                        }\n                    ),\n                ]),\n                icon('fas fa-caret-down', {className: 'Select-caret'}),\n            ]),\n        ]);\n    }\n\n    fieldRequired() {\n        return this.minPrimary > 0 || this.minSecondary > 0;\n    }\n\n    fieldLabel() {\n        let text = app.forum.attribute('raafirivero.mason.tags-field-name') || app.translator.trans('raafirivero-mason.forum.tags.tags-label');\n\n        if (this.fieldRequired()) {\n            text += ' *';\n        }\n\n        return text;\n    }\n\n    placeholderHidden() {\n        if (app.forum.attribute('raafirivero.mason.labels-as-placeholders')) {\n            return false;\n        }\n\n        return this.fieldRequired();\n    }\n\n    selectPlaceholder() {\n        let text = '';\n\n        if (app.forum.attribute('raafirivero.mason.labels-as-placeholders')) {\n            text += this.fieldLabel() + ' - ';\n        }\n\n        if (this.fieldRequired()) {\n            text += app.translator.trans('raafirivero-mason.forum.answers.choose-option');\n        } else {\n            text += app.translator.trans('raafirivero-mason.forum.answers.no-option-selected');\n        }\n\n        return text;\n    }\n}\n","import app from 'flarum/app';\nimport Model from 'flarum/Model';\nimport Component from 'flarum/Component';\n\nexport default class FieldEditText extends Component {\n    init() {\n        this.field = this.props.field;\n        this.answers = this.props.answers;\n        this.onchange = this.props.onchange;\n\n        this.content = '';\n\n        const answersForThisField = this.answers.filter(answer => {\n            // Temporary store entries seem to turn into undefined after saving\n            if (typeof answer === 'undefined') {\n                return false;\n            }\n\n            return answer.field().id() === this.field.id();\n        });\n\n        if (answersForThisField.length) {\n            // For now we only support a single custom answer\n            this.content = answersForThisField[0].content();\n        }\n    }\n\n    view() {\n        return m('input.FormControl', {\n            required: this.field.required(),\n            value: this.content,\n            oninput: m.withAttr('value', value => {\n                this.content = value;\n\n                if (this.content === '') {\n                    this.onchange([]);\n                } else {\n                    const answer = app.store.createRecord('raafirivero-mason-answer', {\n                        attributes: {\n                            content: this.content,\n                        },\n                        relationships: {\n                            field: {\n                                data: Model.getIdentifier(this.field),\n                            },\n                        },\n                    });\n\n                    this.onchange([answer]);\n                }\n            }),\n            placeholder: this.fieldPlaceholder(),\n        });\n    }\n\n    fieldPlaceholder() {\n        if (app.forum.attribute('raafirivero.mason.labels-as-placeholders')) {\n            return this.field.name() + (this.field.required() ? ' *' : '');\n        }\n\n        return '';\n    }\n}\n","import app from 'flarum/app';\nimport Component from 'flarum/Component';\nimport chunkArray from './../helpers/chunkArray';\n\nexport default class FieldGrid extends Component {\n    view() {\n        return m('.Mason-Grid-Wrapper', m('.Mason-Grid', chunkArray(this.props.items, app.forum.attribute('raafirivero.mason.column-count')).map(\n            row => m('.Mason-Row', row.map(\n                item => m('.Mason-Column', item)\n            ))\n        )));\n    }\n}\n","import app from 'flarum/app';\nimport icon from 'flarum/helpers/icon';\nimport ItemList from 'flarum/utils/ItemList';\nimport Component from 'flarum/Component';\nimport sortByAttribute from './../../lib/helpers/sortByAttribute';\nimport FieldEditDropdown from './FieldEditDropdown';\nimport FieldEditText from './FieldEditText';\nimport FieldEditTags from './FieldEditTags';\nimport FieldGrid from './FieldGrid';\n\nexport default class FieldsEditor extends Component {\n    init() {\n        this.fields = sortByAttribute(app.store.all('raafirivero-mason-field'));\n\n        // Index to quickly do a reverse lookup from answer to field\n        this.answerToFieldIndex = [];\n        this.fields.forEach(\n            field => {\n                field.suggested_answers().forEach(\n                    answer => {\n                        this.answerToFieldIndex[answer.id()] = field.id();\n                    }\n                );\n            }\n        );\n    }\n\n    view() {\n        return m('form.Mason-Fields.Mason-Fields--editor', {\n            onsubmit(event) {\n                event.preventDefault();\n            },\n        }, [\n            this.headItems().toArray(),\n            FieldGrid.component({\n                items: this.fieldItems().toArray(),\n            }),\n        ]);\n    }\n\n    updateSelection(field, fieldAnswers) {\n        // Keep only answers to other fields\n        let answers = this.props.answers.filter(\n            answer => {\n                const reverseFieldLookup = this.answerToFieldIndex[answer.id()];\n\n                // If the answer is not in the reverse lookup table it's probably a non-suggested (user) answer\n                // In that case the field should be linked in the relationship\n                if (typeof reverseFieldLookup === 'undefined') {\n                    return answer.field().id() !== field.id();\n                }\n\n                return reverseFieldLookup !== field.id();\n            }\n        );\n\n        answers = answers.concat(fieldAnswers);\n\n        this.props.onchange(answers);\n    }\n\n    headItems() {\n        const items = new ItemList();\n\n        if (app.forum.attribute('raafirivero.mason.fields-section-title')) {\n            items.add('title', m('h5.Mason-Field--title', app.forum.attribute('raafirivero.mason.fields-section-title')));\n        }\n\n        return items;\n    }\n\n    fieldItems() {\n        const items = new ItemList();\n\n        if (app.forum.attribute('raafirivero.mason.tags-as-fields')) {\n            items.add('tags', FieldEditTags.component({\n                discussion: this.props.discussion,\n                onchange: tags => {\n                    if (this.props.ontagchange) {\n                        this.props.ontagchange(tags);\n                    }\n                },\n            }));\n        }\n\n        this.fields.forEach(field => {\n            const inputAttrs = {\n                field,\n                answers: this.props.answers,\n                onchange: fieldAnswers => {\n                    // Every input component calls \"onchange\" with a list of answers from the store\n                    this.updateSelection(field, fieldAnswers);\n                },\n            };\n            let input = null;\n\n            if (field.user_values_allowed()) {\n                input = FieldEditText.component(inputAttrs);\n            } else {\n                input = FieldEditDropdown.component(inputAttrs);\n            }\n\n            items.add('field-' + field.id(), m('.Mason-Field.Form-group', {\n                className: app.forum.attribute('raafirivero.mason.labels-as-placeholders') ? 'Mason-Field--label-as-placeholder' : '',\n            }, [\n                m('label', [\n                    (field.icon() ? [icon(field.icon()), ' '] : null),\n                    field.name(),\n                    (field.required() ? ' *' : null),\n                ]),\n                input,\n                (field.description() ? m('.helpText', field.description()) : null),\n            ]));\n        });\n\n        return items;\n    }\n}\n","import app from 'flarum/app';\nimport icon from 'flarum/helpers/icon';\nimport ItemList from 'flarum/utils/ItemList';\nimport Component from 'flarum/Component';\nimport sortByAttribute from './../../lib/helpers/sortByAttribute';\nimport FieldEditDropdown from './FieldEditDropdown';\nimport FieldEditText from './FieldEditText';\nimport FieldEditTags from './FieldEditTags';\nimport FieldGrid from './FieldGrid';\n\nexport default class FieldsEditorByTags extends Component {\n    init(bytags) {\n        this.fields = sortByAttribute(app.store.all('raafirivero-mason-field'));\n\n        // Index to quickly do a reverse lookup from answer to field\n        this.answerToFieldIndex = [];\n        this.fields.forEach(\n            field => {\n                field.suggested_answers().forEach(\n                    answer => {\n                        this.answerToFieldIndex[answer.id()] = field.id();\n                    }\n                );\n            }\n        );\n    }\n\n    view() {\n        return m('form.Mason-Fields.Mason-Fields--editor', {\n            onsubmit(event) {\n                event.preventDefault();\n            },\n        }, [\n            this.headItems().toArray(),\n            FieldGrid.component({\n                items: this.fieldItems().toArray(),\n            }),\n        ]);\n    }\n\n    updateSelection(field, fieldAnswers) {\n        // Keep only answers to other fields\n        let answers = this.props.answers.filter(\n            answer => {\n                const reverseFieldLookup = this.answerToFieldIndex[answer.id()];\n\n                // If the answer is not in the reverse lookup table it's probably a non-suggested (user) answer\n                // In that case the field should be linked in the relationship\n                if (typeof reverseFieldLookup === 'undefined') {\n                    return answer.field().id() !== field.id();\n                }\n\n                return reverseFieldLookup !== field.id();\n            }\n        );\n\n        answers = answers.concat(fieldAnswers);\n\n        this.props.onchange(answers);\n    }\n\n    headItems() {\n        const items = new ItemList();\n\n        if (app.forum.attribute('raafirivero.mason.fields-section-title')) {\n            items.add('title', m('h5.Mason-Field--title', app.forum.attribute('raafirivero.mason.fields-section-title')));\n        }\n\n        return items;\n    }\n\n    fieldItems() {\n        const items = new ItemList();\n\n        // taking this feature off beacuse changing tags will affect which fields show up\n\n        // if (app.forum.attribute('raafirivero.mason.tags-as-fields')) {\n        //     items.add('tags', FieldEditTags.component({\n        //         discussion: this.props.discussion,\n        //         onchange: tags => {\n        //             if (this.props.ontagchange) {\n        //                 this.props.ontagchange(tags);\n        //             }\n        //         },\n        //     }));\n        // }\n\n        this.fields.forEach(field => {\n            const inputAttrs = {\n                field,\n                bytags: this.props.bytags,\n                answers: this.props.answers,\n                onchange: fieldAnswers => {\n                    // Every input component calls \"onchange\" with a list of answers from the store\n                    this.updateSelection(field, fieldAnswers);\n                },\n            };\n            let input = null;\n\n            if (field.user_values_allowed()) {\n                input = FieldEditText.component(inputAttrs);\n            } else {\n                input = FieldEditDropdown.component(inputAttrs);\n            }\n\n            // if this field is in the list, then add it to items, otherwise, nada.\n            this.props.bytags.forEach( tag => {\n                \n                if ( tag == field.data.attributes.name ) {\n\n                    items.add('field-' + field.id(), m('.Mason-Field.Form-group', {\n                        className: app.forum.attribute('raafirivero.mason.labels-as-placeholders') ? 'Mason-Field--label-as-placeholder' : '',\n                    }, [\n                        m('label', [\n                            (field.icon() ? [icon(field.icon()), ' '] : null),\n                            field.name(),\n                            (field.required() ? ' *' : null),\n                        ]),\n                        input,\n                        (field.description() ? m('.helpText', field.description()) : null),\n                    ]));\n\n                }\n\n            })\n        });\n\n        return items;\n    }\n}\n","import app from 'flarum/app';\nimport Modal from 'flarum/components/Modal';\nimport Button from 'flarum/components/Button';\nimport FieldsEditor from './FieldsEditor';\n\nexport default class FieldsEditorModal extends Modal {\n    init() {\n        super.init();\n\n        this.answers = this.props.discussion.raafiriveroMasonAnswers();\n        this.dirty = false;\n        this.processing = false;\n\n        // Stays null if the feature is not used\n        this.tags = null;\n    }\n\n    title() {\n        return app.translator.trans('raafirivero-mason.forum.answers-modal.edit-title', {\n            title: m('em', this.props.discussion.title()),\n        });\n    }\n\n    content() {\n        return [\n            m('.Modal-body', FieldsEditor.component({\n                discussion: this.props.discussion, // Only for the tags feature\n                answers: this.answers,\n                onchange: this.answersChanged.bind(this),\n                ontagchange: tags => {\n                    this.tags = tags;\n                    this.dirty = true;\n                },\n            })),\n            m('.Modal-footer', [\n                Button.component({\n                    className: 'Button Button--primary',\n                    children: app.translator.trans('raafirivero-mason.forum.answers-modal.save'),\n                    loading: this.processing,\n                    disabled: !this.dirty,\n                    onclick: this.saveAnswers.bind(this),\n                }),\n            ]),\n        ];\n    }\n\n    answersChanged(answers) {\n        this.answers = answers;\n        this.dirty = true;\n    }\n\n    saveAnswers() {\n        this.processing = true;\n\n        let relationships = {\n            raafiriveroMasonAnswers: this.answers,\n        };\n\n        // If tag edit is enabled, take care of them here as well\n        if (this.tags !== null) {\n            relationships.tags = this.tags;\n        }\n\n        this.props.discussion.save({\n            relationships,\n        }).then(() => {\n            this.processing = false;\n            app.modal.close();\n            m.redraw();\n        }).catch(err => {\n            this.processing = false;\n            throw err;\n        });\n    }\n}\n","import app from 'flarum/app';\nimport icon from 'flarum/helpers/icon';\nimport ItemList from 'flarum/utils/ItemList';\nimport Component from 'flarum/Component';\nimport Button from 'flarum/components/Button';\nimport FieldsEditorModal from './FieldsEditorModal';\nimport FieldGrid from './FieldGrid';\nimport sortByAttribute from './../../lib/helpers/sortByAttribute';\n\nexport default class FieldsViewer extends Component {\n    init() {\n        this.fields = sortByAttribute(app.store.all('raafirivero-mason-field'));\n        this.discussion = this.props.discussion;\n    }\n\n    view() {\n        const head = this.headItems().toArray();\n        const fields = this.fieldsItems().toArray();\n\n        // If all fields are hidden\n        // And either no controls are shown or the setting hides them\n        // We don't show the viewer\n        if (!fields.length && (!head.length || app.forum.attribute('raafirivero.mason.hide-empty-fields-section'))) {\n            // We need to return an actual dom element or Flarum does not like it\n            return m('div');\n        }\n\n        return m('.Mason-Fields.Mason-Fields--viewer', [\n            head,\n            FieldGrid.component({\n                items: fields,\n            }),\n        ]);\n    }\n\n    headItems() {\n        const items = new ItemList();\n\n        if (this.discussion.canUpdateRaafiRiveroMasonAnswers()) {\n            items.add('edit', Button.component({\n                className: 'Button Mason-Fields--edit',\n                children: app.translator.trans('raafirivero-mason.forum.discussion-controls.edit-answers'),\n                icon: 'fas fa-pen',\n                onclick: () => app.modal.show(new FieldsEditorModal({\n                    discussion: this.discussion,\n                })),\n            }));\n        }\n\n        if (app.forum.attribute('raafirivero.mason.fields-section-title')) {\n            items.add('title', m('h5.Mason-Field--title', app.forum.attribute('raafirivero.mason.fields-section-title')));\n        }\n\n        return items;\n    }\n\n    fieldsItems() {\n        const items = new ItemList();\n\n        this.fields.forEach(field => {\n            // Discussion answers to this field\n            const answers = sortByAttribute(this.discussion.raafiriveroMasonAnswers().filter(answer => {\n                // It's necessary to compare the field() relationship\n                // Because field.suggested_answers() won't contain new and user answers\n                return answer.field().id() === field.id();\n            }));\n\n            let answer_list = answers.map(answer => m('span.Mason-Inline-Answer', answer.content()));\n\n            if (answers.length === 0) {\n                if (field.show_when_empty()) {\n                    answer_list.push(m('em.Mason-Inline-Answer', app.translator.trans('raafirivero-mason.forum.post-answers.no-answer')));\n                } else {\n                    // If the field has no answer and the setting is off we don't show it\n                    return;\n                }\n            }\n\n            items.add('field-' + field.id(), m('.Mason-Field.Form-group', [\n                m('label', [\n                    (field.icon() ? [icon(field.icon()), ' '] : null),\n                    field.name(),\n                ]),\n                m('.FormControl.Mason-Inline-Answers', answer_list),\n            ]));\n        });\n\n        return items;\n    }\n}\n","/**\n * Split an array into multiple arrays of a given size\n * Useful for grid layouts\n * @see https://stackoverflow.com/a/10456644/3133038\n * @param {Array} items\n * @param {number} itemsPerChunk\n * @returns {Array}\n */\nexport default function (items, itemsPerChunk) {\n    let R = [];\n    for (let i = 0; i < items.length; i += itemsPerChunk) {\n        R.push(items.slice(i, i + itemsPerChunk));\n    }\n    return R;\n}\n","import app from 'flarum/app';\nimport Model from 'flarum/Model';\nimport Discussion from 'flarum/models/Discussion';\nimport Forum from 'flarum/models/Forum';\nimport Answer from './../lib/models/Answer';\nimport Field from './../lib/models/Field';\nimport ByTag from './../lib/models/ByTag';\nimport addComposerFields from './addComposerFields';\nimport addFieldUpdateControl from './addFieldUpdateControl';\nimport addFieldsOnDiscussionHero from './addFieldsOnDiscussionHero';\nimport addFieldsOnDiscussionPost from './addFieldsOnDiscussionPost';\nimport patchModelIdentifier from \"./patchModelIdentifier\";\n\napp.initializers.add('raafirivero-mason', app => {\n    app.store.models['raafirivero-mason-field'] = Field;\n    app.store.models['raafirivero-mason-answer'] = Answer;\n    app.store.models['raafirivero-mason-bytag'] = ByTag;\n\n    Discussion.prototype.raafiriveroMasonAnswers = Model.hasMany('raafiriveroMasonAnswers');\n    Discussion.prototype.canSeeRaafiRiveroMasonAnswers = Model.attribute('canSeeRaafiRiveroMasonAnswers');\n    Discussion.prototype.canUpdateRaafiRiveroMasonAnswers = Model.attribute('canUpdateRaafiRiveroMasonAnswers');\n    Forum.prototype.canFillRaafiRiveroMasonFields = Model.attribute('canFillRaafiRiveroMasonFields');\n\n    addComposerFields();\n    addFieldsOnDiscussionHero();\n    addFieldsOnDiscussionPost();\n    addFieldUpdateControl();\n    patchModelIdentifier();\n});\n","import {override} from 'flarum/extend';\nimport Model from 'flarum/Model';\nimport Answer from './../lib/models/Answer';\n\nexport default function () {\n    override(Model, 'getIdentifier', function (original, model) {\n        // For Answers that don't yet exist, we include the content and the field relationship when calling the API\n        // That way they can be created server-side without making individual API requests for each answer\n        if (model instanceof Answer && !model.exists) {\n            return {\n                type: model.data.type,\n                attributes: {\n                    content: model.data.attributes.content,\n                },\n                relationships: {\n                    field: {\n                        data: Model.getIdentifier(model.data.relationships.field),\n                    },\n                },\n            };\n        }\n\n        // Default behaviour\n        return original(model);\n    })\n}\n","export default function (items, attr = 'sort') {\n    return items.sort(\n        (a, b) => a[attr]() - b[attr]()\n    );\n}\n","import app from 'flarum/app';\nimport Model from 'flarum/Model';\nimport mixin from 'flarum/utils/mixin';\n\nexport default class Answer extends mixin(Model, {\n    content: Model.attribute('content'),\n    is_suggested: Model.attribute('is_suggested'),\n    sort: Model.attribute('sort'),\n    field: Model.hasOne('field'),\n}) {\n    /**\n     * @inheritDoc\n     */\n    apiEndpoint() {\n        return '/raafirivero/mason/answers' + (this.exists ? '/' + this.data.id : '');\n    }\n}\n","import app from 'flarum/app';\nimport Model from 'flarum/Model';\nimport mixin from 'flarum/utils/mixin';\n\nexport default class ByTag extends mixin(Model, {\n    tag_name: Model.attribute('tag_name'),\n    tag_id: Model.attribute('tag_id'),\n    allowed_field: Model.attribute('allowed_field'),\n    switch: Model.attribute('switch'),\n    \n}) {\n    /**\n     * @inheritDoc\n     */\n    apiEndpoint() {\n        return '/raafirivero/mason/bytag' + (this.exists ? '/' + this.data.id : '');\n    }\n}\n","import app from 'flarum/app';\nimport Model from 'flarum/Model';\nimport mixin from 'flarum/utils/mixin';\nimport computed from 'flarum/utils/computed';\n\nexport default class Field extends mixin(Model, {\n    name: Model.attribute('name'),\n    description: Model.attribute('description'),\n    min_answers_count: Model.attribute('min_answers_count'),\n    max_answers_count: Model.attribute('max_answers_count'),\n    show_when_empty: Model.attribute('show_when_empty'),\n    user_values_allowed: Model.attribute('user_values_allowed'),\n    validation: Model.attribute('validation'),\n    icon: Model.attribute('icon'),\n    sort: Model.attribute('sort'),\n    deleted_at: Model.attribute('deleted_at', Model.transformDate),\n    all_answers: Model.hasMany('all_answers'),\n    suggested_answers: Model.hasMany('suggested_answers'),\n    required: computed('min_answers_count', min_answers_count => min_answers_count > 0),\n    multiple: computed('max_answers_count', max_answers_count => max_answers_count > 1),\n}) {\n    /**\n     * @inheritDoc\n     */\n    apiEndpoint() {\n        return '/raafirivero/mason/fields' + (this.exists ? '/' + this.data.id : '');\n    }\n}\n","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['components/Button'];","module.exports = flarum.core.compat['components/CommentPost'];","module.exports = flarum.core.compat['components/Composer'];","module.exports = flarum.core.compat['components/DiscussionComposer'];","module.exports = flarum.core.compat['components/DiscussionHero'];","module.exports = flarum.core.compat['components/Modal'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['helpers/icon'];","module.exports = flarum.core.compat['models/Discussion'];","module.exports = flarum.core.compat['models/Forum'];","module.exports = flarum.core.compat['tags/components/TagDiscussionModal'];","module.exports = flarum.core.compat['tags/utils/sortTags'];","module.exports = flarum.core.compat['utils/DiscussionControls'];","module.exports = flarum.core.compat['utils/ItemList'];","module.exports = flarum.core.compat['utils/computed'];","module.exports = flarum.core.compat['utils/mixin'];"],"sourceRoot":""}